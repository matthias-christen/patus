<?xml version="1.0" encoding="UTF-8"?>
<architectureTypes xsi:noNamespaceSchemaLocation="../src/ch/unibas/cs/hpwc/patus/arch/arch-config.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<!-- Intel x86_64 architecture with SSE, OpenMP parallelization -->
	<architectureType name="Intel x86_64">
		<codegenerator src-suffix="c" backend="OpenMP" use-function-pointers="true"/>
		<parallelism>
			<level number="1" hasExplicitLocalDataCopy="false" asyncIO="false">
				<barrier type="pragma" implementation="omp barrier"/>
			</level>
		</parallelism>
		<datatypes/>
		<declspecs>
			<declspec type="restrictedpointer" specifiers="__restrict__"/>
		</declspecs>
		<intrinsics/>
		<includes>
			<include file="omp.h"/>
		</includes>
		<build compiler-command="make" harness-template-dir="CPU_OpenMP"/>
	</architectureType>

	<architectureType name="Intel x86_64 PAPI" inherits-from="Intel x86_64">
		<build compiler-command="make" harness-template-dir="CPU_OpenMP_PAPI"/>
	</architectureType>

	<!-- Intel x86_64 architecture with SSE, OpenMP parallelization -->
	<architectureType name="Intel x86_64 SSE">
		<codegenerator src-suffix="c" backend="OpenMP" use-function-pointers="true"/>
		<parallelism>
			<level number="1" hasExplicitLocalDataCopy="false" asyncIO="true">
				<barrier type="pragma" implementation="omp barrier"/>
			</level>
		</parallelism>
		<datatypes>
			<!-- declare SSE datatypes -->
			<!-- restrict alignment to 16 bytes -->
			<datatype basetype="float" name="__m128" simdVectorLength="4" width="128" alignment="16"/>
			<datatype basetype="double" name="__m128d" simdVectorLength="2" width="128" alignment="16"/>
		</datatypes>
		<declspecs>
			<declspec type="restrictedpointer" specifiers="__restrict__"/>
		</declspecs>
		<intrinsics>
			<!-- intrinsics for double precision arithmetic operations -->
			<intrinsic baseName="unary_minus" name="neg_pd" datatype="__m128d"/>
			<intrinsic baseName="plus" name="_mm_add_pd" datatype="__m128d"/>
			<intrinsic baseName="minus" name="_mm_sub_pd" datatype="__m128d"/>
			<intrinsic baseName="multiply" name="_mm_mul_pd" datatype="__m128d"/>
			<intrinsic baseName="divide" name="_mm_div_pd" datatype="__m128d"/>
			<intrinsic baseName="sqrt" name="_mm_sqrt_pd" datatype="__m128d"/>
			<intrinsic baseName="min" name="_mm_min_pd" datatype="__m128d"/>
			<intrinsic baseName="max" name="_mm_max_pd" datatype="__m128d"/>
			<!-- ssemathlib.h -->
			<intrinsic baseName="ceil" name="ceil_pd" datatype="__m128d"/>
			<intrinsic baseName="floor" name="floor_pd" datatype="__m128d"/>
			<intrinsic baseName="abs" name="abs_pd" datatype="__m128d"/>
			<intrinsic baseName="exp" name="exp_pd" datatype="__m128d"/>
			<intrinsic baseName="log" name="log_pd" datatype="__m128d"/>
			<intrinsic baseName="log10" name="log10_pd" datatype="__m128d"/>
			<intrinsic baseName="pow" name="pow_pd" datatype="__m128d"/>
			<intrinsic baseName="sin" name="sin_pd" datatype="__m128d"/>
			<intrinsic baseName="cos" name="cos_pd" datatype="__m128d"/>
			<intrinsic baseName="tan" name="tan_pd" datatype="__m128d"/>
			<intrinsic baseName="asin" name="asin_pd" datatype="__m128d"/>
			<intrinsic baseName="acos" name="acos_pd" datatype="__m128d"/>
			<intrinsic baseName="atan" name="atan_pd" datatype="__m128d"/>
			<intrinsic baseName="atan2" name="atan2_pd" datatype="__m128d"/>
			
			<!-- intrinsics for single precision arithmetic operations -->
			<intrinsic baseName="unary_minus" name="neg_ps" datatype="__m128"/>
			<intrinsic baseName="plus" name="_mm_add_ps" datatype="__m128"/>
			<intrinsic baseName="minus" name="_mm_sub_ps" datatype="__m128"/>
			<intrinsic baseName="multiply" name="_mm_mul_ps" datatype="__m128"/>
			<intrinsic baseName="divide" name="_mm_div_ps" datatype="__m128"/>
			<intrinsic baseName="sqrt" name="_mm_sqrt_ps" datatype="__m128"/>
			<intrinsic baseName="min" name="_mm_min_ps" datatype="__m128"/>
			<intrinsic baseName="max" name="_mm_max_ps" datatype="__m128"/>
			<!-- ssemathlib.h -->
			<intrinsic baseName="ceil" name="ceil_ps" datatype="__m128"/>
			<intrinsic baseName="floor" name="floor_ps" datatype="__m128"/>
			<intrinsic baseName="abs" name="abs_ps" datatype="__m128"/>
			<intrinsic baseName="exp" name="exp_ps" datatype="__m128"/>
			<intrinsic baseName="log" name="log_ps" datatype="__m128"/>
			<intrinsic baseName="log10" name="log10_ps" datatype="__m128"/>
			<intrinsic baseName="pow" name="pow_ps" datatype="__m128"/>
			<intrinsic baseName="sin" name="sin_ps" datatype="__m128"/>
			<intrinsic baseName="cos" name="cos_ps" datatype="__m128"/>
			<intrinsic baseName="tan" name="tan_ps" datatype="__m128"/>
			<intrinsic baseName="asin" name="asin_ps" datatype="__m128"/>
			<intrinsic baseName="acos" name="acos_ps" datatype="__m128"/>
			<intrinsic baseName="atan" name="atan_ps" datatype="__m128"/>
			<intrinsic baseName="atan2" name="atan2_ps" datatype="__m128"/>
			
			<!-- non-arithmetic intrinsics -->
		</intrinsics>
		<includes>
			<include file="omp.h"/>
			<include file="xmmintrin.h"/>
			<include file="emmintrin.h"/>
			<include file="ssemathlib.h"/>
		</includes>
		<build compiler-command="make" harness-template-dir="CPU_OpenMP"/>
	</architectureType>

	<!-- Intel x86_64 architecture with SSE, OpenMP parallelization -->
	<architectureType name="Intel x86_64 SSE PAPI" inherits-from="Intel x86_64 SSE">
		<build compiler-command="make" harness-template-dir="CPU_OpenMP_PAPI"/>
	</architectureType>
	
	<!-- Architecture with AVX, OpenMP parallelization -->
	<architectureType name="x86_64 AVX">
		<codegenerator src-suffix="c" backend="OpenMP_AVX" use-function-pointers="true"/>
		<parallelism>
			<level number="1" hasExplicitLocalDataCopy="false" asyncIO="true">
				<barrier type="pragma" implementation="omp barrier"/>
			</level>
		</parallelism>
		<datatypes>
			<!-- declare AVX-256 datatypes -->
			<!-- restrict alignment to 32 bytes -->
			<datatype basetype="float" name="__m256" simdVectorLength="8" width="256" alignment="32"/>
			<datatype basetype="double" name="__m256d" simdVectorLength="4" width="256" alignment="32"/>
		</datatypes>
		<declspecs>
			<declspec type="restrictedpointer" specifiers="__restrict__"/>
		</declspecs>
		<intrinsics>
			<!-- intrinsics for double precision arithmetic operations -->
			<intrinsic baseName="unary_minus" name="neg_pd" datatype="__m256d"/>
			<intrinsic baseName="plus" name="_mm256_add_pd" datatype="__m256d"/>
			<intrinsic baseName="minus" name="_mm256_sub_pd" datatype="__m256d"/>
			<intrinsic baseName="multiply" name="_mm256_mul_pd" datatype="__m256d"/>
			<intrinsic baseName="divide" name="_mm256_div_pd" datatype="__m256d"/>
			<intrinsic baseName="sqrt" name="_mm256_sqrt_pd" datatype="__m256d"/>
			<intrinsic baseName="min" name="_mm256_min_pd" datatype="__m256d"/>
			<intrinsic baseName="max" name="_mm256_max_pd" datatype="__m256d"/>
			
			<!-- intrinsics for single precision arithmetic operations -->
			<intrinsic baseName="unary_minus" name="neg_ps" datatype="__m256"/>
			<intrinsic baseName="plus" name="_mm256_add_ps" datatype="__m256"/>
			<intrinsic baseName="minus" name="_mm256_sub_ps" datatype="__m256"/>
			<intrinsic baseName="multiply" name="_mm256_mul_ps" datatype="__m256"/>
			<intrinsic baseName="divide" name="_mm256_div_ps" datatype="__m256"/>
			<intrinsic baseName="sqrt" name="_mm256_sqrt_ps" datatype="__m256"/>
			<intrinsic baseName="min" name="_mm256_min_ps" datatype="__m256"/>
			<intrinsic baseName="max" name="_mm256_max_ps" datatype="__m256"/>
			
			<!-- non-arithmetic intrinsics -->
		</intrinsics>
		<includes>
			<include file="omp.h"/>
			<include file="immintrin.h"/>
			<include file="x86intrin.h"/>
			<include file="avxmathlib.h"/>
		</includes>
		<build compiler-command="make" harness-template-dir="CPU_OpenMP"/>
	</architectureType>

	<!-- Architecture with AVX+FMA4, OpenMP parallelization -->
	<architectureType name="x86_64 AVX FMA4" inherits-from="x86_64 AVX">
		<datatypes>
			<!-- declare AVX-256 datatypes -->
			<!-- restrict alignment to 32 bytes -->
			<datatype basetype="float" name="__m256" simdVectorLength="8" width="256" alignment="32"/>
			<datatype basetype="double" name="__m256d" simdVectorLength="4" width="256" alignment="32"/>
		</datatypes>
		<intrinsics>
			<!-- intrinsics for double precision arithmetic operations -->
			<intrinsic baseName="unary_minus" name="neg_pd" datatype="__m256d"/>
			<intrinsic baseName="plus" name="_mm256_add_pd" datatype="__m256d"/>
			<intrinsic baseName="minus" name="_mm256_sub_pd" datatype="__m256d"/>
			<intrinsic baseName="multiply" name="_mm256_mul_pd" datatype="__m256d"/>
			<intrinsic baseName="divide" name="_mm256_div_pd" datatype="__m256d"/>
			<intrinsic baseName="sqrt" name="_mm256_sqrt_pd" datatype="__m256d"/>
			<intrinsic baseName="min" name="_mm256_min_pd" datatype="__m256d"/>
			<intrinsic baseName="max" name="_mm256_max_pd" datatype="__m256d"/>
			<intrinsic baseName="fma" name="_mm256_macc_pd" datatype="__m256d" arguments="factor1,factor2,summand"/>
			
			<!-- intrinsics for single precision arithmetic operations -->
			<intrinsic baseName="unary_minus" name="neg_ps" datatype="__m256"/>
			<intrinsic baseName="plus" name="_mm256_add_ps" datatype="__m256"/>
			<intrinsic baseName="minus" name="_mm256_sub_ps" datatype="__m256"/>
			<intrinsic baseName="multiply" name="_mm256_mul_ps" datatype="__m256"/>
			<intrinsic baseName="divide" name="_mm256_div_ps" datatype="__m256"/>
			<intrinsic baseName="sqrt" name="_mm256_sqrt_ps" datatype="__m256"/>
			<intrinsic baseName="min" name="_mm256_min_ps" datatype="__m256"/>
			<intrinsic baseName="max" name="_mm256_max_ps" datatype="__m256"/>
			<intrinsic baseName="fma" name="_mm256_macc_ps" datatype="__m256" arguments="factor1,factor2,summand"/>
		</intrinsics>
	</architectureType>
	
	<architectureType name="x86_64 AVX FMA4 asm" inherits-from="x86_64 AVX">
		<codegenerator src-suffix="c" backend="OpenMP" innermost-loop-cg="x86_64" use-function-pointers="true"/>
		<datatypes>
			<!-- declare SSE datatypes -->
			<!-- restrict alignment to 32 bytes -->
			<datatype basetype="float" name="__m256" simdVectorLength="8" width="256" alignment="32"/>
			<datatype basetype="double" name="__m256d" simdVectorLength="4" width="256" alignment="32"/>
		</datatypes>
		<intrinsics>
			<!-- intrinsics for double precision arithmetic operations -->
			
			<!-- scalar operations -->
			<intrinsic baseName="plus" name="vaddsd" datatype="double" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="minus" name="vsubsd" datatype="double" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="multiply" name="vmulsd" datatype="double" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="divide" name="vdivsd" datatype="double" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="fma" name="vfmaddsd" datatype="double" arguments="reg/mem:summand,reg:factor1,reg:factor2,=reg"/>
			<intrinsic baseName="fms" name="vfmsubsd" datatype="double" arguments="reg/mem:summand,reg:factor1,reg:factor2,=reg"/>
			<intrinsic baseName="move-fpr" name="vmovsd" datatype="double"/>

			<!-- vector operations -->
			<intrinsic baseName="unary_minus" name="neg_pd" datatype="__m256d"/>
			<intrinsic baseName="plus" name="vaddpd" datatype="__m256d" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="minus" name="vsubpd" datatype="__m256d" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="multiply" name="vmulpd" datatype="__m256d" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="divide" name="vdivpd" datatype="__m256d" arguments="reg/mem,reg,=reg"/>
			<!--<intrinsic baseName="sqrt" name="_mm256_sqrt_pd" datatype="__m256d"/>
			<intrinsic baseName="min" name="_mm256_min_pd" datatype="__m256d"/>
			<intrinsic baseName="max" name="_mm256_max_pd" datatype="__m256d"/>-->
			<intrinsic baseName="fma" name="vfmaddpd" datatype="__m256d" arguments="reg/mem:summand,reg:factor1,reg:factor2,=reg"/>
			<intrinsic baseName="fms" name="vfmsubpd" datatype="__m256d" arguments="reg/mem:summand,reg:factor1,reg:factor2,=reg"/>
			<intrinsic baseName="move-fpr" name="vmovapd" datatype="__m256d"/>
			<intrinsic baseName="move-fpr-unaligned" name="vmovupd" datatype="__m256d"/>
			
			<!-- intrinsics for single precision arithmetic operations -->
			
			<!-- scalar operations -->
			<intrinsic baseName="plus" name="vaddss" datatype="float" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="minus" name="vsubss" datatype="float" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="multiply" name="vmulss" datatype="float" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="divide" name="vdivss" datatype="float" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="fma" name="vfmaddss" datatype="float" arguments="reg/mem:summand,reg:factor1,reg:factor2,=reg"/>
			<intrinsic baseName="fms" name="vfmsubss" datatype="float" arguments="reg/mem:summand,reg:factor1,reg:factor2,=reg"/>
			<intrinsic baseName="move-fpr" name="vmovss" datatype="float"/>
			
			<!-- vector operations -->
			<intrinsic baseName="unary_minus" name="neg_ps" datatype="__m256"/>
			<intrinsic baseName="plus" name="vaddps" datatype="__m256" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="minus" name="vsubps" datatype="__m256" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="multiply" name="vmulps" datatype="__m256" arguments="reg/mem,reg,=reg"/>
			<intrinsic baseName="divide" name="vdivps" datatype="__m256" arguments="reg/mem,reg,=reg"/>
			<!--<intrinsic baseName="sqrt" name="_mm256_sqrt_ps" datatype="__m256"/>
			<intrinsic baseName="min" name="_mm256_min_ps" datatype="__m256"/>
			<intrinsic baseName="max" name="_mm256_max_ps" datatype="__m256"/>-->
			<intrinsic baseName="fma" name="vfmaddps" datatype="__m256" arguments="reg/mem:summand,reg:factor1,reg:factor2,=reg"/>
			<intrinsic baseName="fms" name="vfmsubps" datatype="__m256" arguments="reg/mem:summand,reg:factor1,reg:factor2,=reg"/>
			<intrinsic baseName="move-fpr" name="vmovaps" datatype="__m256"/>
			<intrinsic baseName="move-fpr-unaligned" name="vmovups" datatype="__m256"/>
		</intrinsics>
		<assembly>
			<registers>
				<register name="rax" type="gpr" width="64">
					<subregister name="eax" bitrange="0..31"/>
				</register>
				<register name="rbx" type="gpr" width="64">
					<subregister name="ebx" bitrange="0..31"/>
				</register>
				<register name="rcx" type="gpr" width="64">
					<subregister name="ecx" bitrange="0..31"/>
				</register>
				<register name="rdx" type="gpr" width="64">
					<subregister name="edx" bitrange="0..31"/>
				</register>
				<register name="r8" type="gpr" width="64">
					<subregister name="r8d" bitrange="0..31"/>
				</register>				
				<register name="r9" type="gpr" width="64">
					<subregister name="r9d" bitrange="0..31"/>
				</register>				
				<register name="r10" type="gpr" width="64">
					<subregister name="r10d" bitrange="0..31"/>
				</register>				
				<register name="r11" type="gpr" width="64">
					<subregister name="r11d" bitrange="0..31"/>
				</register>				
				<register name="r12" type="gpr" width="64">
					<subregister name="r12d" bitrange="0..31"/>
				</register>				
				<register name="r13" type="gpr" width="64">
					<subregister name="r13d" bitrange="0..31"/>
				</register>				
				<register name="r14" type="gpr" width="64">
					<subregister name="r14d" bitrange="0..31"/>
				</register>				
				<register name="r15" type="gpr" width="64">
					<subregister name="r15d" bitrange="0..31"/>
				</register>				
				<register name="rsi" type="gpr" width="64">
					<subregister name="esi" bitrange="0..31"/>
				</register>
				<register name="rdi" type="gpr" width="64">
					<subregister name="edi" bitrange="0..31"/>
				</register>
				<register name="rbp" type="gpr" width="64">
					<subregister name="ebp" bitrange="0..31"/>
				</register>
				<register name="rsp" type="gpr" width="64">
					<subregister name="esp" bitrange="0..31"/>
				</register>
				
				<register name="ymm0" type="simd" width="256">
					<subregister name="xmm0" bitrange="0..127"/>
				</register>
				<register name="ymm1" type="simd" width="256">
					<subregister name="xmm1" bitrange="0..127"/>
				</register>
				<register name="ymm2" type="simd" width="256">
					<subregister name="xmm2" bitrange="0..127"/>
				</register>
				<register name="ymm3" type="simd" width="256">
					<subregister name="xmm3" bitrange="0..127"/>
				</register>
				<register name="ymm4" type="simd" width="256">
					<subregister name="xmm4" bitrange="0..127"/>
				</register>
				<register name="ymm5" type="simd" width="256">
					<subregister name="xmm5" bitrange="0..127"/>
				</register>
				<register name="ymm6" type="simd" width="256">
					<subregister name="xmm6" bitrange="0..127"/>
				</register>
				<register name="ymm7" type="simd" width="256">
					<subregister name="xmm7" bitrange="0..127"/>
				</register>
				<register name="ymm8" type="simd" width="256">
					<subregister name="xmm8" bitrange="0..127"/>
				</register>
				<register name="ymm9" type="simd" width="256">
					<subregister name="xmm9" bitrange="0..127"/>
				</register>
				<register name="ymm10" type="simd" width="256">
					<subregister name="xmm10" bitrange="0..127"/>
				</register>
				<register name="ymm11" type="simd" width="256">
					<subregister name="xmm11" bitrange="0..127"/>
				</register>
				<register name="ymm12" type="simd" width="256">
					<subregister name="xmm12" bitrange="0..127"/>
				</register>
				<register name="ymm13" type="simd" width="256">
					<subregister name="xmm13" bitrange="0..127"/>
				</register>
				<register name="ymm14" type="simd" width="256">
					<subregister name="xmm14" bitrange="0..127"/>
				</register>
				<register name="ymm15" type="simd" width="256">
					<subregister name="xmm15" bitrange="0..127"/>
				</register>
			</registers>
		</assembly>
	</architectureType>
	
	<!-- NVIDIA CUDA GPU -->
	<architectureType name="NVIDIA CUDA">
		<codegenerator src-suffix="cu" backend="CUDA" use-function-pointers="false"/>
		<parallelism>
			<!--
			<level hasExplicitLocalDataCopy="true" asyncIO="false"/>
			<level hasExplicitLocalDataCopy="false" asyncIO="false"/>-->

			<level number="1" name="ThreadBlock" hasExplicitLocalDataCopy="false" asyncIO="false"/>
			<level number="2" name="Thread" hasExplicitLocalDataCopy="false" asyncIO="false">
				<barrier type="functioncall" implementation="__syncthreads"/>
			</level>
		</parallelism>
		<declspecs>
			<declspec type="kernel" specifiers="__global__"/>
			<declspec type="localfunction" specifiers="__device__"/>
		</declspecs>
		<intrinsics/>
		<includes/>
		<build compiler-command="make" harness-template-dir="GPU_CUDA"/>
	</architectureType>

	<architectureType name="NVIDIA CUDA1D" inherits-from="NVIDIA CUDA">
		<codegenerator src-suffix="cu" backend="CUDA1D" use-function-pointers="false"/>
	</architectureType>

	<!-- NVIDIA CUDA >= 4.0 Fermi GPU -->
	<architectureType name="NVIDIA CUDA4" inherits-from="NVIDIA CUDA">
		<codegenerator src-suffix="cu" backend="CUDA4" use-function-pointers="false"/>
	</architectureType>
</architectureTypes>
